<!--
  Tri-State Aquatic Solutions - Contact Form Component
  Usage: Include this file or copy the HTML for GHL-integrated forms

  Requires: /integrations/gohighlevel/ghl-integration.js
-->

<style>
.tsas-form {
    background: var(--white, #ffffff);
    border: 1px solid var(--gray, #E8ECF1);
    border-radius: 24px;
    padding: 2.5rem;
    max-width: 600px;
}

.tsas-form h2 {
    font-family: 'Cormorant Garamond', Georgia, serif;
    font-size: 2rem;
    margin-bottom: 0.5rem;
    color: var(--navy, #0E1F34);
}

.tsas-form .form-intro {
    color: var(--gray-text, #6B7280);
    margin-bottom: 2rem;
}

.tsas-form .form-group {
    margin-bottom: 1.5rem;
}

.tsas-form label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
    color: var(--navy, #0E1F34);
}

.tsas-form label .required {
    color: #dc2626;
}

.tsas-form input,
.tsas-form select,
.tsas-form textarea {
    width: 100%;
    padding: 1rem;
    border: 1px solid var(--gray, #E8ECF1);
    border-radius: 12px;
    font-family: 'Outfit', -apple-system, sans-serif;
    font-size: 1rem;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.tsas-form input:focus,
.tsas-form select:focus,
.tsas-form textarea:focus {
    outline: none;
    border-color: var(--aqua, #00A6B2);
    box-shadow: 0 0 0 3px rgba(0, 166, 178, 0.15);
}

.tsas-form textarea {
    min-height: 100px;
    resize: vertical;
}

.tsas-form .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

@media (max-width: 640px) {
    .tsas-form .form-row {
        grid-template-columns: 1fr;
    }
}

.tsas-form .btn-submit {
    width: 100%;
    padding: 1.25rem 2rem;
    background: var(--navy, #0E1F34);
    color: var(--white, #ffffff);
    border: none;
    border-radius: 100px;
    font-family: 'Outfit', -apple-system, sans-serif;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

.tsas-form .btn-submit:hover {
    background: var(--aqua, #00A6B2);
    transform: translateY(-2px);
    box-shadow: 0 10px 30px -10px rgba(0, 166, 178, 0.4);
}

.tsas-form .btn-submit:disabled {
    background: #9ca3af;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.tsas-form .form-note {
    font-size: 0.85rem;
    color: var(--gray-text, #6B7280);
    margin-top: 1rem;
    text-align: center;
}

.tsas-form .success-message {
    display: none;
    text-align: center;
    padding: 2rem;
}

.tsas-form .success-message.show {
    display: block;
}

.tsas-form .success-message svg {
    width: 64px;
    height: 64px;
    stroke: #22c55e;
    margin-bottom: 1rem;
}

.tsas-form .success-message h3 {
    color: var(--navy, #0E1F34);
    margin-bottom: 0.5rem;
}

.tsas-form .error-message {
    background: #fef2f2;
    border: 1px solid #fecaca;
    border-radius: 8px;
    padding: 1rem;
    color: #dc2626;
    margin-bottom: 1rem;
    display: none;
}

.tsas-form .error-message.show {
    display: block;
}
</style>

<!-- Contact Form with GHL Integration -->
<form class="tsas-form" data-ghl data-ghl-redirect="/thank-you" id="tsas-contact-form">
    <h2>Get Your Free Quote</h2>
    <p class="form-intro">Tell us about your project and we'll contact you within 24 hours.</p>

    <div class="error-message" id="form-error"></div>

    <div class="form-row">
        <div class="form-group">
            <label for="firstName">First Name <span class="required">*</span></label>
            <input type="text" id="firstName" name="firstName" required autocomplete="given-name">
        </div>
        <div class="form-group">
            <label for="lastName">Last Name <span class="required">*</span></label>
            <input type="text" id="lastName" name="lastName" required autocomplete="family-name">
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label for="email">Email <span class="required">*</span></label>
            <input type="email" id="email" name="email" required autocomplete="email">
        </div>
        <div class="form-group">
            <label for="phone">Phone <span class="required">*</span></label>
            <input type="tel" id="phone" name="phone" required autocomplete="tel" placeholder="(XXX) XXX-XXXX">
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label for="zip">ZIP Code <span class="required">*</span></label>
            <input type="text" id="zip" name="zip" required autocomplete="postal-code" pattern="[0-9]{5}" placeholder="19707">
        </div>
        <div class="form-group">
            <label for="budget">Budget Range</label>
            <select id="budget" name="budget">
                <option value="">Select budget range...</option>
                <option value="$40K-$60K">$40,000 - $60,000</option>
                <option value="$60K-$80K">$60,000 - $80,000</option>
                <option value="$80K-$100K">$80,000 - $100,000</option>
                <option value="$100K+">$100,000+</option>
                <option value="Not sure">Not sure yet</option>
            </select>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label for="timeline">Project Timeline</label>
            <select id="timeline" name="timeline">
                <option value="">When would you like to start?</option>
                <option value="1-3 months">1-3 months</option>
                <option value="3-6 months">3-6 months</option>
                <option value="6-12 months">6-12 months</option>
                <option value="Just researching">Just researching</option>
            </select>
        </div>
        <div class="form-group">
            <label for="poolType">Pool Type Interest</label>
            <select id="poolType" name="poolType">
                <option value="">What type of pool?</option>
                <option value="Fiberglass">Fiberglass (recommended)</option>
                <option value="Concrete">Concrete</option>
                <option value="Vinyl Liner">Vinyl Liner</option>
                <option value="Not sure">Not sure yet</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label for="source">How did you hear about us?</label>
        <select id="source" name="source">
            <option value="">Select one...</option>
            <option value="Google Search">Google Search</option>
            <option value="Facebook">Facebook</option>
            <option value="Instagram">Instagram</option>
            <option value="Referral - Friend/Family">Referral - Friend or Family</option>
            <option value="Referral - Realtor">Referral - Realtor</option>
            <option value="Houzz">Houzz</option>
            <option value="Nextdoor">Nextdoor</option>
            <option value="Home Show">Home Show</option>
            <option value="Saw your work">Saw your work in the neighborhood</option>
            <option value="Other">Other</option>
        </select>
    </div>

    <div class="form-group">
        <label for="message">Tell us about your project (optional)</label>
        <textarea id="message" name="message" placeholder="What does your dream backyard look like?"></textarea>
    </div>

    <button type="submit" class="btn-submit">
        <span class="btn-text">Get My Free Quote</span>
        <span class="btn-loading" style="display: none;">Submitting...</span>
    </button>

    <p class="form-note">We respect your privacy. Your information will never be sold or shared.</p>

    <div class="success-message" id="form-success">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        <h3>Thank You!</h3>
        <p>We've received your request. A member of our team will contact you within 24 hours to schedule your free consultation.</p>
    </div>
</form>

<script>
// Form submission handler for custom forms
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('tsas-contact-form');
    if (!form) return;

    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        const submitBtn = form.querySelector('.btn-submit');
        const btnText = form.querySelector('.btn-text');
        const btnLoading = form.querySelector('.btn-loading');
        const errorEl = document.getElementById('form-error');
        const successEl = document.getElementById('form-success');

        // Reset states
        errorEl.classList.remove('show');
        errorEl.textContent = '';

        // Show loading
        submitBtn.disabled = true;
        btnText.style.display = 'none';
        btnLoading.style.display = 'inline';

        try {
            // Use GHL integration if available
            if (window.GHLIntegration) {
                const payload = window.GHLIntegration.handleFormSubmission(form);

                // Send to server
                const response = await fetch('/api/ghl/contacts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error('Failed to submit form');
                }

                // Show success
                form.style.display = 'none';
                successEl.classList.add('show');

                // Track conversion
                if (window.dataLayer) {
                    window.dataLayer.push({
                        event: 'lead_form_submit',
                        form_name: 'contact_form',
                        lead_score: window.GHLIntegration.calculateLeadScore()
                    });
                }

                // Redirect after delay (if specified)
                const redirectUrl = form.dataset.ghlRedirect;
                if (redirectUrl) {
                    setTimeout(() => {
                        window.location.href = redirectUrl;
                    }, 2000);
                }
            } else {
                // Fallback: submit to GHL form directly
                console.warn('GHL Integration not loaded, using fallback');
                // Would need to implement direct form post here
                throw new Error('Form integration not available');
            }

        } catch (error) {
            console.error('Form error:', error);
            errorEl.textContent = 'There was an error submitting your form. Please call us at (484) 843-9765.';
            errorEl.classList.add('show');

            // Reset button
            submitBtn.disabled = false;
            btnText.style.display = 'inline';
            btnLoading.style.display = 'none';
        }
    });

    // Phone formatting
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                if (value.length <= 3) {
                    value = '(' + value;
                } else if (value.length <= 6) {
                    value = '(' + value.substring(0, 3) + ') ' + value.substring(3);
                } else {
                    value = '(' + value.substring(0, 3) + ') ' + value.substring(3, 6) + '-' + value.substring(6, 10);
                }
            }
            e.target.value = value;
        });
    }
});
</script>
