<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KXFWZNHH');</script>
<!-- End Google Tag Manager -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MPSDTSG1H6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-MPSDTSG1H6');
</script>
<!-- End Google Analytics 4 -->
<!-- PostHog Analytics -->
<script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_AEHl0m89HvS8SsSGjB83vMZBgH73rqR7PYbKneWBUig',{api_host:'https://us.i.posthog.com', person_profiles: 'always'})
</script>
<!-- End PostHog Analytics -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Your Pool | Tri-State Aquatic Solutions</title>
    <meta name="description" content="Design your dream pool in minutes. Choose your pool type, finish, and upgrades. Premium plunge and cocktail pool installation for Main Line PA and Delaware.">

    <link rel="canonical" href="https://tristateaquaticsolutions.com/design-your-pool/">

    <meta property="og:title" content="Design Your Pool | Tri-State Aquatic Solutions">
    <meta property="og:description" content="Design your dream pool in minutes. Choose your pool type, finish, and upgrades.">
    <meta property="og:url" content="https://tristateaquaticsolutions.com/design-your-pool/">
    <meta property="og:type" content="website">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/shared.css">

    <style>
        /* ==================== NAV OFFSET FOR BANNER ==================== */
        nav { top: 40px; }

        /* ==================== CONFIGURATOR LAYOUT ==================== */
        .configurator-wrapper {
            min-height: 100vh;
            padding-top: 140px;
            padding-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        /* ==================== PROGRESS BAR ==================== */
        .progress-bar {
            position: fixed;
            top: 100px;
            left: 0;
            right: 0;
            z-index: 998;
            display: flex;
            gap: 4px;
            padding: 0 clamp(1.5rem, 5vw, 4rem);
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding-top: 12px;
            padding-bottom: 12px;
        }

        .progress-segment {
            flex: 1;
            height: 4px;
            border-radius: 4px;
            background: var(--gray);
            transition: background 0.5s var(--ease-out-expo);
            position: relative;
            overflow: hidden;
        }

        .progress-segment.active {
            background: var(--gold);
        }

        .progress-segment.active::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, var(--gold), var(--gold-light));
            border-radius: 4px;
            animation: shimmer 2s ease infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .progress-segment.completed {
            background: var(--gold);
        }

        .progress-segment.completed::after {
            display: none;
        }

        /* ==================== STEP INDICATOR (MOBILE) ==================== */
        .step-indicator {
            display: none;
        }

        /* ==================== STEPS CONTAINER ==================== */
        .steps-container {
            position: relative;
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 clamp(1.5rem, 5vw, 4rem);
        }

        .step {
            display: none;
            opacity: 0;
            transform: translateX(60px);
            transition: opacity 0.6s var(--ease-out-expo), transform 0.6s var(--ease-out-expo);
        }

        .step.active {
            display: block;
        }

        .step.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .step.exit-left {
            opacity: 0;
            transform: translateX(-60px);
        }

        /* ==================== STEP HEADER ==================== */
        .step-header {
            text-align: center;
            margin-bottom: 3rem;
            padding-top: 2rem;
        }

        .step-header .step-label {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 0.75rem;
        }

        .step-header h2 {
            font-size: clamp(2rem, 4.5vw, 3rem);
            color: var(--navy);
            margin-bottom: 0.75rem;
        }

        .step-header p {
            font-size: 1.1rem;
            color: var(--gray-text);
            max-width: 550px;
            margin: 0 auto;
        }

        /* ==================== LIFESTYLE CARDS (Step 1) ==================== */
        .lifestyle-cards {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .lifestyle-card {
            position: relative;
            border-radius: 24px;
            padding: 2.5rem;
            cursor: pointer;
            transition: all 0.5s var(--ease-out-expo);
            border: 3px solid transparent;
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: end;
            gap: 2rem;
            min-height: 240px;
            background-size: cover !important;
            background-position: center !important;
        }

        .lifestyle-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 21px;
            z-index: 0;
        }

        .lifestyle-card:nth-child(1) {
            background: linear-gradient(135deg, rgba(14,31,52,0.55) 0%, rgba(22,42,66,0.45) 50%, rgba(14,31,52,0.65) 100%),
                        url('/images/wellness-plunge.jpg') center/cover no-repeat;
        }

        .lifestyle-card:nth-child(2) {
            background: linear-gradient(135deg, rgba(10,42,58,0.5) 0%, rgba(13,48,64,0.4) 50%, rgba(10,42,58,0.6) 100%),
                        url('/images/pools/family-lifestyle.jpg') center/cover no-repeat;
        }

        .lifestyle-card:nth-child(3) {
            background: linear-gradient(135deg, rgba(26,32,54,0.5) 0%, rgba(30,40,64,0.4) 50%, rgba(26,32,54,0.6) 100%),
                        url('/images/pools/pool-spa-combo.jpg') center/cover no-repeat;
        }

        .lifestyle-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 60px -15px rgba(14, 31, 52, 0.5);
            background-size: 110% !important;
        }

        .lifestyle-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 55%;
            background: linear-gradient(to top, rgba(14,31,52,0.85) 0%, rgba(14,31,52,0.3) 60%, transparent 100%);
            z-index: 0;
            pointer-events: none;
        }

        .lifestyle-card.selected {
            border-color: var(--gold);
            box-shadow: 0 0 0 1px var(--gold), 0 20px 60px -15px rgba(201, 169, 98, 0.4);
        }

        .lifestyle-card-content {
            position: relative;
            z-index: 1;
        }

        .lifestyle-card-badge {
            display: inline-block;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            padding: 0.3rem 0.75rem;
            border-radius: 100px;
            margin-bottom: 0.75rem;
            background: rgba(201, 169, 98, 0.2);
            color: var(--gold);
        }

        .lifestyle-card-badge.popular {
            background: rgba(0, 166, 178, 0.2);
            color: var(--aqua);
        }

        .lifestyle-card h3 {
            font-size: clamp(1.4rem, 2.5vw, 1.75rem);
            color: var(--white);
            margin-bottom: 0.5rem;
        }

        .lifestyle-card p {
            color: rgba(255, 255, 255, 0.65);
            font-size: 0.95rem;
            line-height: 1.6;
            max-width: 420px;
        }

        .lifestyle-card-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .lifestyle-card-tags span {
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            padding: 0.25rem 0.6rem;
            border-radius: 100px;
            background: rgba(255, 255, 255, 0.12);
            color: rgba(255, 255, 255, 0.75);
            white-space: nowrap;
        }

        .lifestyle-card-size-diagram {
            position: absolute;
            top: 1rem;
            left: 1.25rem;
            z-index: 1;
            background: rgba(14, 31, 52, 0.7);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            border-radius: 12px;
            padding: 0.6rem 0.75rem;
            border: 1px solid rgba(201, 169, 98, 0.25);
        }

        .lifestyle-card-size-diagram svg {
            display: block;
        }

        .lifestyle-card-meta {
            position: relative;
            z-index: 1;
            text-align: right;
        }

        .lifestyle-card-price {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gold);
            margin-bottom: 0.25rem;
        }

        .lifestyle-card-size {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .lifestyle-card-check {
            position: absolute;
            top: 1.25rem;
            right: 1.25rem;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.4s var(--ease-out-expo);
            z-index: 2;
        }

        .lifestyle-card-check svg {
            width: 16px;
            height: 16px;
            stroke: var(--navy);
            stroke-width: 3;
            fill: none;
        }

        .lifestyle-card.selected .lifestyle-card-check {
            opacity: 1;
            transform: scale(1);
        }

        /* ==================== FINISH CARDS (Step 2) ==================== */
        .finish-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.25rem;
        }

        .finish-card {
            position: relative;
            border-radius: 24px;
            padding: 2rem;
            padding-top: 160px;
            cursor: pointer;
            transition: all 0.5s var(--ease-out-expo);
            border: 3px solid var(--gray);
            background: var(--white);
            text-align: center;
            min-height: 380px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            overflow: hidden;
        }

        .finish-card:hover {
            transform: translateY(-4px);
            border-color: var(--aqua);
            box-shadow: 0 15px 40px -10px rgba(0, 166, 178, 0.2);
        }

        .finish-card.selected {
            border-color: var(--gold);
            box-shadow: 0 0 0 1px var(--gold), 0 15px 40px -10px rgba(201, 169, 98, 0.3);
        }

        .finish-swatch {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 150px;
            border-radius: 21px 21px 0 0;
            overflow: hidden;
            transition: transform 0.6s var(--ease-out-expo);
        }

        .finish-card:hover .finish-swatch {
            transform: scale(1.05);
        }

        .finish-card:nth-child(1) .finish-swatch {
            background: linear-gradient(to bottom, transparent 40%, rgba(255,255,255,0.9) 100%),
                        url('/images/pools/concrete-hero.jpg') center/cover no-repeat;
        }

        .finish-card:nth-child(2) .finish-swatch {
            background: linear-gradient(to bottom, transparent 40%, rgba(255,255,255,0.9) 100%),
                        url('/images/pools/gladwyne-estate.jpg') center/cover no-repeat;
        }

        .finish-card:nth-child(3) .finish-swatch {
            background: linear-gradient(to bottom, transparent 40%, rgba(255,255,255,0.9) 100%),
                        url('/images/pools/fiberglass-hero.jpg') center/cover no-repeat;
        }

        .finish-card h3 {
            font-size: 1.25rem;
            color: var(--navy);
            margin-bottom: 0.35rem;
        }

        .finish-card p {
            font-size: 0.85rem;
            color: var(--gray-text);
            line-height: 1.5;
        }

        .finish-card-check {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.4s var(--ease-out-expo);
        }

        .finish-card-check svg {
            width: 14px;
            height: 14px;
            stroke: var(--navy);
            stroke-width: 3;
            fill: none;
        }

        .finish-card.selected .finish-card-check {
            opacity: 1;
            transform: scale(1);
        }

        .finish-details {
            list-style: none;
            padding: 0;
            margin: 0.75rem 0 0;
            text-align: left;
        }

        .finish-details li {
            font-size: 0.78rem;
            color: var(--gray-text);
            line-height: 1.5;
            padding: 0.15rem 0;
            padding-left: 1.1rem;
            position: relative;
        }

        .finish-details li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: var(--gold);
            font-weight: 700;
            font-size: 0.7rem;
        }

        .finish-price-note {
            font-size: 0.75rem;
            color: var(--gray-text);
            margin-top: 0.75rem;
            font-weight: 500;
        }

        .finish-price-note.savings {
            color: var(--aqua);
        }

        /* Color Swatches for Fiberglass */
        .color-swatches {
            margin-top: 2rem;
            text-align: center;
            display: none;
        }

        .color-swatches.visible {
            display: block;
            animation: fadeInUp 0.5s var(--ease-out-expo);
        }

        .color-swatches h4 {
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--navy);
            margin-bottom: 1rem;
        }

        .swatch-grid {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .swatch {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s var(--ease-out-expo);
            position: relative;
        }

        .swatch:hover {
            transform: scale(1.15);
        }

        .swatch.selected {
            border-color: var(--gold);
            box-shadow: 0 0 0 2px var(--gold);
        }

        .swatch[data-color="light"] { background: #d4e4f0; }
        .swatch[data-color="medium"] { background: #6fa8c7; }
        .swatch[data-color="dark"] { background: #2c5f7c; }
        .swatch[data-color="platinum"] { background: #c0c8d0; }
        .swatch[data-color="horizon"] { background: #7cb5a8; }
        .swatch[data-color="moonlight"] { background: #3a4a5c; }

        .swatch-label {
            display: block;
            font-size: 0.65rem;
            color: var(--gray-text);
            margin-top: 0.35rem;
            text-align: center;
        }

        /* ==================== SELECTED POOL HERO (Step 1) ==================== */
        .selected-pool-hero {
            position: relative;
            margin-top: 2rem;
            border-radius: 24px;
            overflow: hidden;
            height: 320px;
            display: none;
            animation: fadeInUp 0.5s var(--ease-out-expo);
        }

        .selected-pool-hero.visible {
            display: block;
        }

        .selected-pool-hero img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .selected-pool-hero-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 2rem 2.5rem;
            background: linear-gradient(to top, rgba(14,31,52,0.95) 0%, rgba(14,31,52,0.4) 60%, transparent 100%);
        }

        .selected-pool-hero-name {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 0.25rem;
        }

        .selected-pool-hero-dims {
            font-size: 0.9rem;
            color: var(--gold);
            font-weight: 500;
        }

        .pool-dimension-diagram {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(14, 31, 52, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 16px;
            padding: 1rem;
            border: 1px solid rgba(201, 169, 98, 0.3);
        }

        .pool-dimension-diagram svg {
            display: block;
        }

        /* ==================== MODEL GALLERY (after Step 1 selection) ==================== */
        .model-gallery {
            margin-top: 2rem;
            display: none;
            animation: fadeInUp 0.5s var(--ease-out-expo);
        }

        .model-gallery.visible {
            display: block;
        }

        .model-gallery-header {
            text-align: center;
            margin-bottom: 1.25rem;
        }

        .model-gallery-header h4 {
            font-family: var(--font-body);
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 0.25rem;
        }

        .model-gallery-header p {
            font-size: 0.9rem;
            color: var(--gray-text);
        }

        .model-strip {
            padding: 0.5rem 0 0;
        }

        .pool-specs-panel {
            background: var(--gray-light);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--gray);
        }

        .specs-quick-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--gray);
        }

        .specs-stat {
            text-align: center;
        }

        .specs-stat-value {
            display: block;
            font-family: var(--font-display);
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--navy);
            margin-bottom: 0.2rem;
        }

        .specs-stat-label {
            display: block;
            font-size: 0.72rem;
            font-weight: 500;
            color: var(--gray-text);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .specs-features-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.6rem 1.5rem;
            margin-bottom: 1rem;
        }

        .specs-feature {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.88rem;
            color: var(--navy);
        }

        .specs-feature svg {
            flex-shrink: 0;
        }

        .specs-note {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            background: rgba(201, 169, 98, 0.08);
            border-left: 3px solid var(--gold);
            border-radius: 0 8px 8px 0;
            font-size: 0.85rem;
            color: var(--navy);
            font-style: italic;
        }

        /* ==================== UPGRADE CARDS (Step 3) ==================== */
        .upgrade-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .upgrade-card {
            position: relative;
            border-radius: 20px;
            padding-top: 120px;
            padding-left: 1.25rem;
            padding-right: 1.25rem;
            padding-bottom: 1.25rem;
            cursor: pointer;
            transition: all 0.4s var(--ease-out-expo);
            border: 2px solid var(--gray);
            background: var(--white);
            text-align: center;
            overflow: hidden;
        }

        .upgrade-card:hover {
            transform: translateY(-3px);
            border-color: var(--aqua);
            box-shadow: 0 12px 30px -8px rgba(0, 166, 178, 0.15);
        }

        .upgrade-card.selected {
            border-color: var(--gold);
            background: rgba(201, 169, 98, 0.04);
            box-shadow: 0 0 0 1px var(--gold);
        }

        .upgrade-card.pre-included {
            border-color: var(--aqua);
            background: rgba(0, 166, 178, 0.04);
            pointer-events: none;
        }

        .upgrade-photo {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 110px;
            overflow: hidden;
            border-radius: 18px 18px 0 0;
        }

        .upgrade-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s var(--ease-out-expo);
        }

        .upgrade-card:hover .upgrade-photo img {
            transform: scale(1.08);
        }

        .upgrade-photo::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(to top, var(--white) 0%, transparent 100%);
        }

        .upgrade-card.selected .upgrade-photo::after {
            background: linear-gradient(to top, rgba(255,252,245,1) 0%, transparent 100%);
        }

        .upgrade-icon {
            width: 52px;
            height: 52px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            background: var(--gray-light);
            transition: background 0.3s ease;
        }

        .upgrade-card.selected .upgrade-icon {
            background: rgba(201, 169, 98, 0.15);
        }

        .upgrade-icon svg {
            width: 24px;
            height: 24px;
            stroke: var(--navy);
            stroke-width: 1.5;
            fill: none;
        }

        .upgrade-card.selected .upgrade-icon svg {
            stroke: var(--gold);
        }

        .upgrade-card h3 {
            font-family: var(--font-body);
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--navy);
            margin-bottom: 0.25rem;
        }

        .upgrade-desc {
            font-size: 0.78rem;
            color: var(--gray-text);
            line-height: 1.4;
            margin-bottom: 0.35rem;
        }

        .upgrade-price-indicator {
            font-size: 0.8rem;
            color: var(--gold);
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .upgrade-card.pre-included .upgrade-price-indicator {
            color: var(--aqua);
        }

        .upgrade-toggle {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--gray);
            transition: all 0.3s var(--ease-out-expo);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upgrade-card.selected .upgrade-toggle {
            background: var(--gold);
            border-color: var(--gold);
        }

        .upgrade-toggle svg {
            width: 12px;
            height: 12px;
            stroke: var(--white);
            stroke-width: 3;
            fill: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .upgrade-card.selected .upgrade-toggle svg {
            opacity: 1;
        }

        .skip-upgrades {
            text-align: center;
            margin-top: 1.5rem;
        }

        .skip-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: none;
            border: 2px solid var(--gray);
            border-radius: 100px;
            color: var(--gray-text);
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s var(--ease-out-expo);
        }

        .skip-btn:hover {
            border-color: var(--navy);
            color: var(--navy);
        }

        /* ==================== SUMMARY (Step 4) ==================== */
        .step.step-summary .step-header h2 {
            color: var(--white);
        }

        .step.step-summary .step-header p {
            color: rgba(255, 255, 255, 0.65);
        }

        .step.step-summary .step-header .step-label {
            color: var(--gold);
        }

        .step.step-summary {
            background: linear-gradient(180deg, var(--navy) 0%, #0a1525 100%);
            margin: -2rem -clamp(1.5rem, 5vw, 4rem);
            padding: 2rem clamp(1.5rem, 5vw, 4rem) 4rem;
            border-radius: 0;
        }

        /* ==================== SOCIAL PROOF (Step 4 top) ==================== */
        .social-proof-section {
            max-width: 700px;
            margin: 0 auto 3rem;
            text-align: center;
        }

        .social-proof-stat {
            margin-bottom: 2rem;
        }

        .stat-number {
            font-family: var(--font-display);
            font-size: clamp(3rem, 6vw, 4.5rem);
            font-weight: 700;
            color: var(--gold);
            line-height: 1;
            margin-bottom: 0.35rem;
        }

        .stat-label {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
        }

        .social-proof-quote {
            margin: 0 0 2rem;
            padding: 0;
            border: none;
        }

        .social-proof-quote p {
            font-family: var(--font-display);
            font-size: clamp(1.1rem, 2.2vw, 1.4rem);
            font-style: italic;
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }

        .social-proof-quote cite {
            font-style: normal;
            font-family: var(--font-body);
            font-size: 0.85rem;
            color: var(--gold);
            font-weight: 500;
        }

        .social-proof-gallery {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .social-proof-gallery img {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(201, 169, 98, 0.4);
            transition: all 0.4s var(--ease-out-expo);
        }

        .social-proof-gallery img:hover {
            border-color: var(--gold);
            transform: scale(1.1);
        }

        .trust-badges {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .trust-badge {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 0.02em;
        }

        .trust-badge svg {
            color: var(--gold);
            opacity: 0.7;
        }

        .summary-hero {
            position: relative;
            border-radius: 24px;
            overflow: hidden;
            max-width: 900px;
            margin: 0 auto 2rem;
            height: 280px;
        }

        .summary-hero img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .summary-hero-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 2rem;
            background: linear-gradient(to top, rgba(14,31,52,0.95) 0%, transparent 100%);
        }

        .summary-hero-label {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--white);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .summary-selections {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 2rem;
        }

        .summary-selections h3 {
            font-size: 1.1rem;
            color: var(--white);
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-item-label {
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.45);
        }

        .summary-item-value {
            font-size: 0.95rem;
            color: var(--white);
            text-align: right;
            font-weight: 500;
        }

        .summary-pricing {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .price-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 2rem;
            text-align: center;
        }

        .price-card-label {
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 0.75rem;
        }

        .price-range {
            font-family: var(--font-display);
            font-size: clamp(2rem, 4vw, 2.75rem);
            font-weight: 600;
            color: var(--white);
            line-height: 1.2;
            margin-bottom: 0.5rem;
        }

        .price-note {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .financing-card {
            background: rgba(201, 169, 98, 0.08);
            border: 1px solid rgba(201, 169, 98, 0.2);
            border-radius: 20px;
            padding: 1.5rem;
            text-align: center;
        }

        .financing-label {
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .financing-amount {
            font-family: var(--font-display);
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 0.25rem;
        }

        .financing-terms {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.45);
        }

        /* What's Included Grid */
        .summary-included {
            max-width: 900px;
            margin: 2rem auto 0;
        }

        .summary-included h3 {
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 1rem;
            text-align: center;
        }

        .included-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }

        .included-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.75);
            padding: 0.5rem 0.75rem;
            background: rgba(255, 255, 255, 0.04);
            border-radius: 8px;
        }

        .included-check {
            color: var(--aqua);
            font-weight: 700;
            font-size: 0.9rem;
        }

        /* What's Not Included (collapsed) */
        .summary-not-included {
            max-width: 600px;
            margin: 1.5rem auto 0;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .summary-not-included:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .not-included-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .not-included-header h4 {
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.5);
        }

        .not-included-header svg {
            color: rgba(255, 255, 255, 0.4);
            transition: transform 0.3s var(--ease-out-expo);
        }

        .summary-not-included.open .not-included-header svg {
            transform: rotate(180deg);
        }

        .not-included-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s var(--ease-out-expo);
        }

        .summary-not-included.open .not-included-details {
            max-height: 300px;
        }

        .not-included-item {
            display: flex;
            justify-content: space-between;
            padding: 0.6rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .not-included-item:last-of-type {
            border-bottom: none;
        }

        .not-included-note {
            font-size: 0.78rem;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 0.75rem;
            text-align: center;
            font-style: italic;
        }

        .summary-ctas {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 2.5rem;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .summary-ctas .cta-btn {
            justify-content: center;
            width: 100%;
            padding: 1.15rem 2rem;
            font-size: 1.05rem;
        }

        .summary-ctas .cta-btn.secondary {
            background: rgba(255, 255, 255, 0.08);
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .summary-ctas .cta-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        /* ==================== DEPOSIT FORM (Step 5) ==================== */
        .deposit-form-wrapper {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-section {
            margin-bottom: 2rem;
        }

        .form-section h3 {
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 600;
            color: var(--navy);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--gray);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--navy);
            margin-bottom: 0.35rem;
            letter-spacing: 0.02em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.85rem 1rem;
            border: 2px solid var(--gray);
            border-radius: 12px;
            font-family: var(--font-body);
            font-size: 1rem;
            color: var(--navy);
            background: var(--white);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            -webkit-appearance: none;
            min-height: 48px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(201, 169, 98, 0.15);
        }

        .form-group input::placeholder {
            color: var(--gray-text);
            opacity: 0.6;
        }

        /* Config Summary (Collapsed) */
        .config-summary-collapse {
            background: var(--gray-light);
            border-radius: 16px;
            padding: 1.25rem 1.5rem;
            margin-bottom: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .config-summary-collapse:hover {
            background: var(--gray);
        }

        .config-summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .config-summary-header h4 {
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--navy);
        }

        .config-summary-header svg {
            width: 20px;
            height: 20px;
            stroke: var(--gray-text);
            stroke-width: 2;
            fill: none;
            transition: transform 0.3s var(--ease-out-expo);
        }

        .config-summary-collapse.open .config-summary-header svg {
            transform: rotate(180deg);
        }

        .config-summary-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s var(--ease-out-expo);
        }

        .config-summary-collapse.open .config-summary-details {
            max-height: 300px;
        }

        .config-detail-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.85rem;
            border-bottom: 1px solid var(--gray);
        }

        .config-detail-item:last-child {
            border-bottom: none;
        }

        .config-detail-item .label {
            color: var(--gray-text);
        }

        .config-detail-item .value {
            color: var(--navy);
            font-weight: 500;
        }

        /* Deposit Info */
        .deposit-info {
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .deposit-amount {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .deposit-label {
            font-size: 0.95rem;
            color: var(--white);
            margin-bottom: 0.5rem;
        }

        .deposit-refund {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .deposit-refund strong {
            color: var(--aqua);
        }

        /* Legal */
        .legal-text {
            font-size: 0.75rem;
            color: var(--gray-text);
            line-height: 1.7;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray);
        }

        .deposit-submit-btn {
            width: 100%;
            padding: 1.15rem 2rem;
            background: var(--gold);
            color: var(--navy);
            border: none;
            border-radius: 100px;
            font-family: var(--font-body);
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s var(--ease-out-expo);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            min-height: 56px;
        }

        .deposit-submit-btn:hover {
            background: var(--gold-light);
            transform: translateY(-2px);
            box-shadow: 0 15px 30px -10px rgba(201, 169, 98, 0.5);
        }

        .deposit-submit-btn svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }

        .consultation-link {
            display: block;
            text-align: center;
            margin-top: 1rem;
            color: var(--aqua);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: opacity 0.3s ease;
        }

        .consultation-link:hover {
            opacity: 0.8;
        }

        /* ==================== NAVIGATION BUTTONS ==================== */
        .step-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--gray);
        }

        .step.step-summary .step-nav {
            border-top-color: rgba(255, 255, 255, 0.1);
        }

        .step-nav .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.85rem 1.5rem;
            background: none;
            border: 2px solid var(--gray);
            border-radius: 100px;
            color: var(--gray-text);
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s var(--ease-out-expo);
            min-height: 48px;
        }

        .step-nav .back-btn:hover {
            border-color: var(--navy);
            color: var(--navy);
        }

        .step.step-summary .step-nav .back-btn {
            border-color: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.6);
        }

        .step.step-summary .step-nav .back-btn:hover {
            border-color: rgba(255, 255, 255, 0.4);
            color: var(--white);
        }

        .step-nav .back-btn svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }

        .step-nav .continue-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.85rem 2rem;
            background: var(--gold);
            color: var(--navy);
            border: none;
            border-radius: 100px;
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s var(--ease-out-expo);
            min-height: 48px;
            opacity: 0.4;
            pointer-events: none;
        }

        .step-nav .continue-btn.enabled {
            opacity: 1;
            pointer-events: auto;
        }

        .step-nav .continue-btn:hover {
            background: var(--gold-light);
            transform: translateY(-2px);
            box-shadow: 0 12px 25px -8px rgba(201, 169, 98, 0.5);
        }

        .step-nav .continue-btn svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }

        /* ==================== MOBILE STICKY CONTINUE ==================== */
        .mobile-sticky-nav {
            display: none;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 1024px) {
            .finish-cards {
                grid-template-columns: 1fr 1fr;
            }

            .upgrade-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .configurator-wrapper {
                padding-top: 120px;
            }

            .progress-bar {
                top: 85px;
            }

            nav { top: 32px; }

            .step-indicator {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 0.5rem clamp(1.5rem, 5vw, 4rem);
                position: fixed;
                top: 120px;
                left: 0;
                right: 0;
                z-index: 997;
                background: rgba(255,255,255,0.95);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                font-size: 0.85rem;
                font-weight: 500;
                color: var(--gray-text);
                border-bottom: 1px solid var(--gray);
            }

            .step-indicator .back-arrow {
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
                border: none;
                background: none;
                cursor: pointer;
                color: var(--navy);
                min-height: 48px;
                min-width: 48px;
            }

            .step-indicator .back-arrow svg {
                width: 20px;
                height: 20px;
                stroke: currentColor;
                stroke-width: 2;
                fill: none;
            }

            .step-indicator .close-btn {
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
                border: none;
                background: none;
                cursor: pointer;
                color: var(--gray-text);
                min-height: 48px;
                min-width: 48px;
            }

            .step-indicator .close-btn svg {
                width: 20px;
                height: 20px;
                stroke: currentColor;
                stroke-width: 2;
                fill: none;
            }

            .configurator-wrapper {
                padding-top: 165px;
            }

            .step-header {
                padding-top: 1rem;
            }

            .lifestyle-card {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1.75rem;
                min-height: 200px;
            }

            .lifestyle-card-meta {
                text-align: left;
            }

            .lifestyle-card-tags span {
                font-size: 0.65rem;
            }

            .selected-pool-hero {
                height: 220px;
                border-radius: 16px;
            }

            .selected-pool-hero-name {
                font-size: 1.5rem;
            }

            .pool-dimension-diagram {
                display: none;
            }

            .included-grid {
                grid-template-columns: 1fr 1fr;
            }

            .specs-quick-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            .specs-features-list {
                grid-template-columns: 1fr;
            }

            .pool-specs-panel {
                padding: 1.5rem;
            }

            .lifestyle-card-size-diagram {
                top: 0.75rem;
                left: 0.75rem;
                padding: 0.4rem 0.5rem;
            }

            .lifestyle-card-size-diagram svg {
                transform: scale(0.85);
                transform-origin: top left;
            }

            .social-proof-gallery img:nth-child(n+4) {
                display: none;
            }

            .trust-badges {
                gap: 0.75rem 1rem;
            }

            .summary-hero {
                height: 200px;
                border-radius: 16px;
            }

            .finish-cards {
                grid-template-columns: 1fr;
            }

            .upgrade-grid {
                grid-template-columns: 1fr 1fr;
            }

            .upgrade-card {
                padding-top: 100px;
            }

            .upgrade-photo {
                height: 90px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .step-nav {
                display: none;
            }

            .mobile-sticky-nav {
                display: block;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 998;
                background: var(--white);
                padding: 1rem 1.5rem;
                box-shadow: 0 -4px 20px rgba(14, 31, 52, 0.1);
                border-top: 1px solid var(--gray);
            }

            .mobile-sticky-nav .continue-btn {
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.75rem;
                padding: 1rem 2rem;
                background: var(--gold);
                color: var(--navy);
                border: none;
                border-radius: 100px;
                font-family: var(--font-body);
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                min-height: 52px;
                opacity: 0.4;
                pointer-events: none;
            }

            .mobile-sticky-nav .continue-btn.enabled {
                opacity: 1;
                pointer-events: auto;
            }

            .mobile-sticky-nav .continue-btn svg {
                width: 18px;
                height: 18px;
                stroke: currentColor;
                stroke-width: 2;
                fill: none;
            }

            .step.step-summary {
                margin: -1rem -1.5rem;
                padding: 1.5rem 1.5rem 4rem;
            }
        }

        @media (max-width: 480px) {
            .upgrade-grid {
                grid-template-columns: 1fr;
            }

            .upgrade-card {
                padding-top: 130px;
            }

            .upgrade-photo {
                height: 120px;
            }

            .specs-quick-stats {
                grid-template-columns: repeat(2, 1fr);
                font-size: 0.9rem;
            }

            .lifestyle-card-size-diagram {
                display: none;
            }

            .swatch-grid {
                gap: 0.5rem;
            }

            .swatch {
                width: 42px;
                height: 42px;
            }
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KXFWZNHH" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Urgency Banner -->
    <div class="urgency-banner">
        <span class="banner-text">
            <span class="banner-highlight">Spring 2026 Installation Spots Available</span>
            &mdash; Now accepting deposits. Limited spots remaining.
        </span>
        <a href="/contact/">Book Free Consultation</a>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="container">
            <a href="/" class="logo">
                <div class="logo-mark"></div>
                <div class="logo-text">
                    Tri-State Aquatic
                    <span>Solutions</span>
                </div>
            </a>

            <a href="tel:+13028703113" class="nav-phone">
                <svg viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg>
                (302) 870-3113
            </a>

            <ul class="nav-links">
                <li>
                    <a href="/pools/">
                        Pool Installation
                        <svg class="nav-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
                    </a>
                    <div class="mega-menu">
                        <div class="mega-menu-column install-column">
                            <h4>Pool Types</h4>
                            <ul>
                                <li><a href="/pools/plunge-pools/"><div class="menu-icon"><svg viewBox="0 0 24 24"><rect x="3" y="8" width="18" height="10" rx="2"/><path d="M7 8V6a2 2 0 012-2h6a2 2 0 012 2v2"/></svg></div><div class="menu-text">Plunge Pools<span>Compact luxury retreats</span></div></a></li>
                                <li><a href="/pools/cocktail-pools/"><div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M8 21h8M12 17v4M12 3a9 9 0 019 9v5H3v-5a9 9 0 019-9z"/></svg></div><div class="menu-text">Cocktail Pools<span>Perfect for entertaining</span></div></a></li>
                                <li><a href="/pools/fiberglass/"><div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M2 12h2a2 2 0 012 2v4a2 2 0 01-2 2H2v-8z"/><rect x="6" y="8" width="12" height="12" rx="2"/></svg></div><div class="menu-text">Fiberglass Pools<span>Quick install, low maintenance</span></div></a></li>
                            </ul>
                            <a href="/contact/" class="featured"><div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></div><div class="menu-text">Schedule Consultation<span>Free design & estimate</span></div></a>
                        </div>
                    </div>
                </li>
                <li>
                    <a href="/pool-maintenance/">
                        Pool Services
                        <svg class="nav-arrow" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
                    </a>
                    <div class="mega-menu wide">
                        <div class="mega-menu-grid">
                            <div class="mega-menu-column services-column">
                                <h4>Maintenance</h4>
                                <ul>
                                    <li><a href="/services/weekly-maintenance/"><div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div><div class="menu-text">Weekly Maintenance<span>From $150/month</span></div></a></li>
                                    <li><a href="/services/pool-opening/"><div class="menu-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2"/></svg></div><div class="menu-text">Pool Opening<span>Spring startup service</span></div></a></li>
                                    <li><a href="/services/pool-closing/"><div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"/><circle cx="12" cy="12" r="3"/></svg></div><div class="menu-text">Pool Closing<span>Winterization service</span></div></a></li>
                                </ul>
                            </div>
                            <div class="mega-menu-column services-column">
                                <h4>Repairs</h4>
                                <ul>
                                    <li><a href="/services/equipment-repair/"><div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg></div><div class="menu-text">Equipment Repair<span>All major brands</span></div></a></li>
                                    <li><a href="/services/emergency/"><div class="menu-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></div><div class="menu-text">24/7 Emergency<span>Urgent repairs</span></div></a></li>
                                </ul>
                                <a href="/pool-maintenance/" class="featured"><div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M21 12H3M21 6H3M21 18H3"/></svg></div><div class="menu-text">View All Services<span>Complete service catalog</span></div></a>
                            </div>
                        </div>
                    </div>
                </li>
                <li><a href="/gallery/">Gallery</a></li>
                <li><a href="/locations/">Service Areas</a></li>
                <li><a href="/contact/" class="nav-cta">Get Free Quote</a></li>
                <li><a href="/design-your-pool/" class="nav-cta" style="background:var(--gold);color:var(--navy);margin-left:0.5rem;">Design Your Pool</a></li>
            </ul>

            <button class="mobile-toggle" aria-label="Toggle menu" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-section">
            <h4>Call Us</h4>
            <ul><li><a href="tel:+13028703113">(302) 870-3113</a></li></ul>
        </div>
        <div class="mobile-menu-section install-section">
            <h4>Pool Installation</h4>
            <ul>
                <li><a href="/pools/plunge-pools/">Plunge Pools</a></li>
                <li><a href="/pools/cocktail-pools/">Cocktail Pools</a></li>
                <li><a href="/pools/fiberglass/">Fiberglass Pools</a></li>
                <li><a href="/design-your-pool/" style="color:var(--gold);font-weight:600;">Design Your Pool</a></li>
            </ul>
        </div>
        <div class="mobile-menu-section">
            <h4>Pool Services</h4>
            <ul>
                <li><a href="/services/weekly-maintenance/">Weekly Maintenance</a></li>
                <li><a href="/services/pool-opening/">Pool Opening</a></li>
                <li><a href="/services/pool-closing/">Pool Closing</a></li>
                <li><a href="/services/equipment-repair/">Equipment Repair</a></li>
                <li><a href="/services/emergency/">Emergency Service</a></li>
                <li><a href="/pool-maintenance/">All Services</a></li>
            </ul>
        </div>
        <div class="mobile-menu-section">
            <h4>More</h4>
            <ul>
                <li><a href="/gallery/">Gallery</a></li>
                <li><a href="/locations/">Service Areas</a></li>
                <li><a href="/contact/">Contact Us</a></li>
            </ul>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar">
        <div class="progress-segment" data-step="1"></div>
        <div class="progress-segment" data-step="2"></div>
        <div class="progress-segment" data-step="3"></div>
        <div class="progress-segment" data-step="4"></div>
        <div class="progress-segment" data-step="5"></div>
    </div>

    <!-- Mobile Step Indicator -->
    <div class="step-indicator" id="stepIndicator">
        <button class="back-arrow" id="mobileBack" aria-label="Go back">
            <svg viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </button>
        <span id="stepText">Step 1 of 5</span>
        <a href="/" class="close-btn" aria-label="Close configurator">
            <svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </a>
    </div>

    <!-- Configurator -->
    <div class="configurator-wrapper">
        <div class="steps-container">

            <!-- STEP 1: Pool Experience -->
            <div class="step active" data-step="1" id="step1">
                <div class="step-header">
                    <div class="step-label">Step 1 of 5</div>
                    <h2>What kind of pool experience?</h2>
                    <p>Choose the pool that matches your lifestyle. Every option is fully customizable.</p>
                </div>

                <div class="lifestyle-cards">
                    <!-- The Devon -->
                    <div class="lifestyle-card" data-pool="devon" onclick="selectPool(this)">
                        <div class="lifestyle-card-check">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <div class="lifestyle-card-size-diagram">
                            <svg width="72" height="52" viewBox="0 0 72 52">
                                <rect x="1" y="1" width="35" height="50" rx="4" fill="rgba(0,166,178,0.25)" stroke="#C9A962" stroke-width="1.2"/>
                                <text x="18.5" y="30" text-anchor="middle" fill="#C9A962" font-size="8" font-family="Outfit" font-weight="600">7'Ã—13'</text>
                                <rect x="42" y="16" width="28" height="20" rx="3" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="0.8" stroke-dasharray="2,2"/>
                            </svg>
                        </div>
                        <div class="lifestyle-card-content">
                            <div class="lifestyle-card-badge">Intimate Luxury</div>
                            <h3>The Devon</h3>
                            <p>Wellness-focused elegance for discerning spaces. Cold plunge, warm soak, or quiet retreat â€” all in a compact footprint.</p>
                            <div class="lifestyle-card-tags">
                                <span>Best for: Couples & Wellness</span>
                                <span>Fits 2-4</span>
                                <span>52" depth</span>
                            </div>
                        </div>
                        <div class="lifestyle-card-meta">
                            <div class="lifestyle-card-price">From $45,000</div>
                            <div class="lifestyle-card-size">7' Ã— 13'</div>
                        </div>
                    </div>

                    <!-- The Gladwyne -->
                    <div class="lifestyle-card" data-pool="gladwyne" onclick="selectPool(this)">
                        <div class="lifestyle-card-check">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <div class="lifestyle-card-size-diagram">
                            <svg width="82" height="60" viewBox="0 0 82 60">
                                <rect x="1" y="1" width="45" height="58" rx="4" fill="rgba(0,166,178,0.25)" stroke="#C9A962" stroke-width="1.2"/>
                                <text x="23.5" y="34" text-anchor="middle" fill="#C9A962" font-size="8" font-family="Outfit" font-weight="600">9'Ã—16'</text>
                                <rect x="52" y="16" width="28" height="20" rx="3" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="0.8" stroke-dasharray="2,2"/>
                                <text x="66" y="29" text-anchor="middle" fill="rgba(255,255,255,0.3)" font-size="5.5" font-family="Outfit">hot tub</text>
                            </svg>
                        </div>
                        <div class="lifestyle-card-content">
                            <div class="lifestyle-card-badge popular">Most Popular</div>
                            <h3>The Gladwyne</h3>
                            <p>Our most requested size â€” room for the kids to play, space to entertain, and the perfect canvas for your backyard vision.</p>
                            <div class="lifestyle-card-tags">
                                <span>Best for: Families & Entertaining</span>
                                <span>Fits 4-6</span>
                                <span>3'5" - 5' depth</span>
                            </div>
                        </div>
                        <div class="lifestyle-card-meta">
                            <div class="lifestyle-card-price">From $55,000</div>
                            <div class="lifestyle-card-size">9' Ã— 16'</div>
                        </div>
                    </div>

                    <!-- The Brandywine -->
                    <div class="lifestyle-card" data-pool="brandywine" onclick="selectPool(this)">
                        <div class="lifestyle-card-check">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <div class="lifestyle-card-size-diagram">
                            <svg width="108" height="60" viewBox="0 0 108 60">
                                <rect x="1" y="1" width="70" height="58" rx="4" fill="rgba(0,166,178,0.25)" stroke="#C9A962" stroke-width="1.2"/>
                                <text x="35" y="34" text-anchor="middle" fill="#C9A962" font-size="8" font-family="Outfit" font-weight="600">9'Ã—21'</text>
                                <line x1="72" y1="1" x2="72" y2="59" stroke="#C9A962" stroke-width="0.8" stroke-dasharray="3,2"/>
                                <rect x="72" y="1" width="35" height="58" rx="4" fill="rgba(201,169,98,0.15)" stroke="#C9A962" stroke-width="1.2"/>
                                <text x="89.5" y="30" text-anchor="middle" fill="#C9A962" font-size="6" font-family="Outfit" font-weight="500">+ SPA</text>
                                <text x="89.5" y="38" text-anchor="middle" fill="rgba(201,169,98,0.6)" font-size="5" font-family="Outfit">optional</text>
                            </svg>
                        </div>
                        <div class="lifestyle-card-content">
                            <div class="lifestyle-card-badge">Grand Estate</div>
                            <h3>The Brandywine</h3>
                            <p>The largest plunge pool available. Optional integrated spa, room for lap swimming, and the ultimate backyard transformation.</p>
                            <div class="lifestyle-card-tags">
                                <span>Best for: Lap Swimming & Spa</span>
                                <span>Fits 6-10</span>
                                <span>3'5" - 5'4" depth</span>
                            </div>
                        </div>
                        <div class="lifestyle-card-meta">
                            <div class="lifestyle-card-price">From $68,000</div>
                            <div class="lifestyle-card-size">9' Ã— 21'</div>
                        </div>
                    </div>
                </div>

                <!-- Selected Pool Hero - appears after selection -->
                <div class="selected-pool-hero" id="selectedPoolHero">
                    <img id="selectedPoolHeroImg" src="" alt="Selected pool">
                    <div class="selected-pool-hero-overlay">
                        <div class="selected-pool-hero-name" id="selectedPoolHeroName"></div>
                        <div class="selected-pool-hero-dims" id="selectedPoolHeroDims"></div>
                    </div>
                    <div class="pool-dimension-diagram" id="poolDiagramSvg"></div>
                </div>

                <!-- Pool Specs - appears after pool selection -->
                <div class="model-gallery" id="modelGallery">
                    <div class="model-gallery-header">
                        <h4>What's Included</h4>
                        <p id="modelGallerySubtitle">Standard features included with every pool</p>
                    </div>
                    <div class="model-strip" id="modelStrip">
                        <!-- Populated dynamically by JS -->
                    </div>
                </div>

                <div class="step-nav">
                    <div></div>
                    <button class="continue-btn" id="continueStep1" onclick="goToStep(2)">
                        Continue
                        <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </button>
                </div>
            </div>

            <!-- STEP 2: Finish -->
            <div class="step" data-step="2" id="step2">
                <div class="step-header">
                    <div class="step-label">Step 2 of 5</div>
                    <h2>Choose your construction method</h2>
                    <p>Each option affects look, install time, and maintenance. The right choice depends on your timeline and style.</p>
                </div>

                <div class="finish-cards">
                    <!-- Precast Concrete -->
                    <div class="finish-card" data-finish="concrete" onclick="selectFinish(this)">
                        <div class="finish-card-check">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <div class="finish-swatch"></div>
                        <h3>Precast Concrete</h3>
                        <p>6" steel-reinforced concrete shell with smooth textured PVC interior lining.</p>
                        <ul class="finish-details">
                            <li>Most customizable â€” any shape add-ons</li>
                            <li>15-year watertight guarantee</li>
                            <li>Install: 6-8 weeks total</li>
                        </ul>
                        <div class="finish-price-note">Included in base price</div>
                    </div>

                    <!-- Plaster & Tile -->
                    <div class="finish-card" data-finish="plaster" onclick="selectFinish(this)">
                        <div class="finish-card-check">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <div class="finish-swatch"></div>
                        <h3>Plaster & Tile</h3>
                        <p>PebbleSheen plaster finish with custom waterline tile on concrete shell.</p>
                        <ul class="finish-details">
                            <li>Rich, textured feel underfoot</li>
                            <li>Custom tile colors and patterns</li>
                            <li>Install: 7-9 weeks total</li>
                        </ul>
                        <div class="finish-price-note">+$3,000 - $5,000</div>
                    </div>

                    <!-- Fiberglass Composite -->
                    <div class="finish-card" data-finish="fiberglass" onclick="selectFinish(this)">
                        <div class="finish-card-check">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <div class="finish-swatch"></div>
                        <h3>Fiberglass Composite</h3>
                        <p>Graphene-infused composite shell â€” 200x stronger than steel, 30% lighter than concrete.</p>
                        <ul class="finish-details">
                            <li>Factory-finished â€” 6 color options</li>
                            <li>Fastest install: 2-3 weeks total</li>
                            <li>Lowest lifetime maintenance</li>
                        </ul>
                        <div class="finish-price-note savings">Save $5,000 - $8,000</div>
                    </div>
                </div>

                <!-- Color Swatches for Fiberglass -->
                <div class="color-swatches" id="colorSwatches">
                    <h4>Choose Your Shell Color</h4>
                    <div class="swatch-grid">
                        <div>
                            <div class="swatch selected" data-color="light" onclick="selectColor(this)"></div>
                            <span class="swatch-label">Light</span>
                        </div>
                        <div>
                            <div class="swatch" data-color="medium" onclick="selectColor(this)"></div>
                            <span class="swatch-label">Medium</span>
                        </div>
                        <div>
                            <div class="swatch" data-color="dark" onclick="selectColor(this)"></div>
                            <span class="swatch-label">Dark</span>
                        </div>
                        <div>
                            <div class="swatch" data-color="platinum" onclick="selectColor(this)"></div>
                            <span class="swatch-label">Platinum</span>
                        </div>
                        <div>
                            <div class="swatch" data-color="horizon" onclick="selectColor(this)"></div>
                            <span class="swatch-label">Horizon</span>
                        </div>
                        <div>
                            <div class="swatch" data-color="moonlight" onclick="selectColor(this)"></div>
                            <span class="swatch-label">Moonlight</span>
                        </div>
                    </div>
                </div>

                <div class="step-nav">
                    <button class="back-btn" onclick="goToStep(1)">
                        <svg viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                        Back
                    </button>
                    <button class="continue-btn" id="continueStep2" onclick="goToStep(3)">
                        Continue
                        <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </button>
                </div>
            </div>

            <!-- STEP 3: Upgrades -->
            <div class="step" data-step="3" id="step3">
                <div class="step-header">
                    <div class="step-label">Step 3 of 5</div>
                    <h2>Make it yours</h2>
                    <p>Select any upgrades to enhance your pool experience. Choose as many as you'd like.</p>
                </div>

                <div class="upgrade-grid" id="upgradeGrid">
                    <!-- Pool Heater -->
                    <div class="upgrade-card" data-upgrade="heater" onclick="toggleUpgrade(this)">
                        <div class="upgrade-toggle"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
                        <div class="upgrade-photo">
                            <img src="/images/pools/evening-entertaining.jpg" alt="Pool heater for year-round comfort" loading="lazy">
                        </div>
                        <h3>Pool Heater</h3>
                        <p class="upgrade-desc">Extend your season from April to October</p>
                        <div class="upgrade-price-indicator">$$</div>
                    </div>

                    <!-- Tanning Ledge -->
                    <div class="upgrade-card" data-upgrade="tanning-ledge" onclick="toggleUpgrade(this)">
                        <div class="upgrade-toggle"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
                        <div class="upgrade-photo">
                            <img src="/images/pools/tanning-ledge.jpg" alt="Built-in tanning ledge" loading="lazy">
                        </div>
                        <h3>Tanning Ledge</h3>
                        <p class="upgrade-desc">Shallow lounge area for sunbathing</p>
                        <div class="upgrade-price-indicator">$$</div>
                    </div>

                    <!-- Built-In Bench -->
                    <div class="upgrade-card" data-upgrade="bench" onclick="toggleUpgrade(this)">
                        <div class="upgrade-toggle"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
                        <div class="upgrade-photo">
                            <img src="/images/pools/gladwyne-estate.jpg" alt="Built-in bench seating" loading="lazy">
                        </div>
                        <h3>Built-In Bench</h3>
                        <p class="upgrade-desc">Comfortable seating inside the pool</p>
                        <div class="upgrade-price-indicator">$</div>
                    </div>

                    <!-- Hydrotherapy Jets -->
                    <div class="upgrade-card" data-upgrade="jets" onclick="toggleUpgrade(this)">
                        <div class="upgrade-toggle"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
                        <div class="upgrade-photo">
                            <img src="/images/wellness-plunge.jpg" alt="Hydrotherapy jets for wellness" loading="lazy">
                        </div>
                        <h3>Hydrotherapy Jets</h3>
                        <p class="upgrade-desc">Therapeutic massage jets for recovery</p>
                        <div class="upgrade-price-indicator">$$</div>
                    </div>

                    <!-- Automatic Cover -->
                    <div class="upgrade-card" data-upgrade="cover" onclick="toggleUpgrade(this)">
                        <div class="upgrade-toggle"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
                        <div class="upgrade-photo">
                            <img src="/images/pools/delaware-modern.jpg" alt="Automatic pool cover" loading="lazy">
                        </div>
                        <h3>Automatic Cover</h3>
                        <p class="upgrade-desc">Safety, cleanliness & heat retention</p>
                        <div class="upgrade-price-indicator">$$$</div>
                    </div>

                    <!-- Smart Controls -->
                    <div class="upgrade-card" data-upgrade="smart" onclick="toggleUpgrade(this)">
                        <div class="upgrade-toggle"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
                        <div class="upgrade-photo">
                            <img src="/images/pools/family-lifestyle.jpg" alt="Smart pool controls" loading="lazy">
                        </div>
                        <h3>Smart Controls</h3>
                        <p class="upgrade-desc">Control everything from your phone</p>
                        <div class="upgrade-price-indicator">$$</div>
                    </div>
                </div>

                <!-- Built-In Spa (shown only for Cape+) -->
                <div class="upgrade-grid" id="spaUpgrade" style="display:none; margin-top:1rem;">
                    <div class="upgrade-card pre-included">
                        <div class="upgrade-toggle" style="background:var(--aqua);border-color:var(--aqua);">
                            <svg viewBox="0 0 24 24" style="opacity:1;"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <div class="upgrade-photo">
                            <img src="/images/pools/pool-spa-combo.jpg" alt="Built-in spa" loading="lazy">
                        </div>
                        <h3>Built-In Spa</h3>
                        <p class="upgrade-desc">Integrated hot tub built into your pool</p>
                        <div class="upgrade-price-indicator">Included</div>
                    </div>
                </div>

                <div class="skip-upgrades">
                    <button class="skip-btn" onclick="skipUpgrades()">
                        No upgrades, keep it simple
                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </button>
                </div>

                <div class="step-nav">
                    <button class="back-btn" onclick="goToStep(2)">
                        <svg viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                        Back
                    </button>
                    <button class="continue-btn enabled" id="continueStep3" onclick="goToStep(4)">
                        Continue
                        <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </button>
                </div>
            </div>

            <!-- STEP 4: Summary -->
            <div class="step step-summary" data-step="4" id="step4">
                <div class="step-header">
                    <div class="step-label">Step 4 of 5</div>
                    <h2>Your Pool, Your Way</h2>
                    <p>Here's your custom pool configuration and estimated investment.</p>
                </div>

                <!-- Social Proof -->
                <div class="social-proof-section">
                    <div class="social-proof-stat">
                        <div class="stat-number" id="poolCounter">0</div>
                        <div class="stat-label">Pools Installed Across the Main Line & Delaware</div>
                    </div>
                    <blockquote class="social-proof-quote">
                        <p>&ldquo;We couldn&rsquo;t be happier with our pool. The team was professional, on schedule, and the result exceeded our expectations.&rdquo;</p>
                        <cite>&mdash; Sarah & Mike T., Gladwyne, PA</cite>
                    </blockquote>
                    <div class="social-proof-gallery">
                        <img src="/images/pools/gladwyne-estate.jpg" alt="Pool in Gladwyne" loading="lazy">
                        <img src="/images/pools/delaware-modern.jpg" alt="Pool in Delaware" loading="lazy">
                        <img src="/images/pools/evening-entertaining.jpg" alt="Evening pool entertaining" loading="lazy">
                        <img src="/images/pools/family-lifestyle.jpg" alt="Family pool" loading="lazy">
                    </div>
                    <div class="trust-badges">
                        <div class="trust-badge">
                            <svg viewBox="0 0 24 24" width="18" height="18"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>
                            Licensed & Insured
                        </div>
                        <div class="trust-badge">
                            <svg viewBox="0 0 24 24" width="18" height="18"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>
                            15-Year Warranty
                        </div>
                        <div class="trust-badge">
                            <svg viewBox="0 0 24 24" width="18" height="18"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" fill="none" stroke="currentColor" stroke-width="1.5"/><polyline points="9 22 9 12 15 12 15 22" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>
                            Local Family-Owned
                        </div>
                        <div class="trust-badge">
                            <svg viewBox="0 0 24 24" width="18" height="18"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" fill="none" stroke="currentColor" stroke-width="1.5"/><polyline points="14 2 14 8 20 8" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>
                            PA HIC Registered
                        </div>
                    </div>
                </div>

                <!-- Pool visualization -->
                <div class="summary-hero" id="summaryHero">
                    <img id="summaryHeroImg" src="/images/pools/family-lifestyle.jpg" alt="Your selected pool style">
                    <div class="summary-hero-overlay">
                        <span class="summary-hero-label" id="summaryHeroLabel">Your Pool</span>
                    </div>
                </div>

                <div class="summary-grid">
                    <div class="summary-selections">
                        <h3>Your Selections</h3>
                        <div class="summary-item">
                            <span class="summary-item-label">Experience</span>
                            <span class="summary-item-value" id="summaryPool">--</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-item-label">Finish</span>
                            <span class="summary-item-value" id="summaryFinish">--</span>
                        </div>
                        <div class="summary-item" id="summaryColorRow" style="display:none;">
                            <span class="summary-item-label">Shell Color</span>
                            <span class="summary-item-value" id="summaryColor">--</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-item-label">Upgrades</span>
                            <span class="summary-item-value" id="summaryUpgrades">None</span>
                        </div>
                    </div>

                    <div class="summary-pricing">
                        <div class="price-card">
                            <div class="price-card-label">Estimated Investment</div>
                            <div class="price-range" id="summaryPrice">$52,000 - $65,000</div>
                            <div class="price-note">Final pricing confirmed at consultation</div>
                        </div>
                        <div class="financing-card">
                            <div class="financing-label">Monthly Financing</div>
                            <div class="financing-amount" id="summaryMonthly">$485/mo</div>
                            <div class="financing-terms">180-month term at 7.99% APR example</div>
                        </div>
                    </div>
                </div>

                <!-- What's Included -->
                <div class="summary-included">
                    <h3>What's Included</h3>
                    <div class="included-grid">
                        <div class="included-item"><span class="included-check">&#10003;</span> LED Lighting</div>
                        <div class="included-item"><span class="included-check">&#10003;</span> Variable Speed Pump</div>
                        <div class="included-item"><span class="included-check">&#10003;</span> Cartridge Filter</div>
                        <div class="included-item"><span class="included-check">&#10003;</span> 4 Return Jets</div>
                        <div class="included-item"><span class="included-check">&#10003;</span> Surface Skimmer</div>
                        <div class="included-item"><span class="included-check">&#10003;</span> Steel Handrail</div>
                        <div class="included-item"><span class="included-check">&#10003;</span> Professional Install</div>
                        <div class="included-item"><span class="included-check">&#10003;</span> 15-Year Warranty</div>
                    </div>
                </div>

                <!-- What's Not Included (collapsed) -->
                <div class="summary-not-included" onclick="this.classList.toggle('open')">
                    <div class="not-included-header">
                        <h4>Typical Additional Costs</h4>
                        <svg viewBox="0 0 24 24" width="18" height="18"><polyline points="6 9 12 15 18 9" stroke="currentColor" stroke-width="2" fill="none"/></svg>
                    </div>
                    <div class="not-included-details">
                        <div class="not-included-item"><span>Permits & Engineering</span><span>$2,000 - $5,000</span></div>
                        <div class="not-included-item"><span>Decking & Hardscape</span><span>$10,000 - $30,000</span></div>
                        <div class="not-included-item"><span>Electrical Hookup</span><span>$2,000 - $4,000</span></div>
                        <div class="not-included-item"><span>Landscaping</span><span>Varies</span></div>
                        <p class="not-included-note">We provide exact costs at your free consultation.</p>
                    </div>
                </div>

                <div class="summary-ctas">
                    <button class="cta-btn gold" onclick="goToStep(5)">
                        Secure Your Spot &mdash; $1,000 Deposit
                        <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                    </button>
                    <a href="/contact/" class="cta-btn secondary">
                        Schedule Free Consultation
                        <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
                    </a>
                </div>

                <div class="step-nav">
                    <button class="back-btn" onclick="goToStep(3)">
                        <svg viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                        Back
                    </button>
                    <div></div>
                </div>
            </div>

            <!-- STEP 5: Deposit Form -->
            <div class="step" data-step="5" id="step5">
                <div class="step-header">
                    <div class="step-label">Step 5 of 5</div>
                    <h2>Secure Your Installation Spot</h2>
                    <p>Reserve your Spring 2026 installation with a fully refundable design deposit.</p>
                </div>

                <div class="deposit-form-wrapper">
                    <!-- Deposit Info -->
                    <div class="deposit-info">
                        <div class="deposit-amount">$1,000</div>
                        <div class="deposit-label">Design Deposit</div>
                        <div class="deposit-refund"><strong>Fully refundable</strong> within 72 hours of payment</div>
                    </div>

                    <!-- Configuration Summary (Collapsible) -->
                    <div class="config-summary-collapse" id="configCollapse" onclick="toggleConfigSummary()">
                        <div class="config-summary-header">
                            <h4>Your Pool Configuration</h4>
                            <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="config-summary-details" id="configDetails">
                            <div class="config-detail-item">
                                <span class="label">Pool</span>
                                <span class="value" id="configPool">--</span>
                            </div>
                            <div class="config-detail-item">
                                <span class="label">Finish</span>
                                <span class="value" id="configFinish">--</span>
                            </div>
                            <div class="config-detail-item">
                                <span class="label">Upgrades</span>
                                <span class="value" id="configUpgrades">None</span>
                            </div>
                            <div class="config-detail-item">
                                <span class="label">Estimated Price</span>
                                <span class="value" id="configPrice">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Form -->
                    <form id="depositForm" onsubmit="handleDeposit(event)">
                        <div class="form-section">
                            <h3>Your Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firstName">First Name</label>
                                    <input type="text" id="firstName" name="firstName" required placeholder="First name" autocomplete="given-name">
                                </div>
                                <div class="form-group">
                                    <label for="lastName">Last Name</label>
                                    <input type="text" id="lastName" name="lastName" required placeholder="Last name" autocomplete="family-name">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" name="email" required placeholder="you@email.com" inputmode="email" autocomplete="email">
                                </div>
                                <div class="form-group">
                                    <label for="phone">Phone</label>
                                    <input type="tel" id="phone" name="phone" required placeholder="(555) 555-5555" inputmode="tel" autocomplete="tel">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Installation Address</h3>
                            <div class="form-row full">
                                <div class="form-group">
                                    <label for="address">Street Address</label>
                                    <input type="text" id="address" name="address" required placeholder="123 Main St" autocomplete="street-address">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="city">City</label>
                                    <input type="text" id="city" name="city" required placeholder="City" autocomplete="address-level2">
                                </div>
                                <div class="form-group">
                                    <label for="state">State</label>
                                    <select id="state" name="state" required autocomplete="address-level1">
                                        <option value="">Select state</option>
                                        <option value="DE">Delaware</option>
                                        <option value="PA">Pennsylvania</option>
                                        <option value="NJ">New Jersey</option>
                                        <option value="MD">Maryland</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="zip">ZIP Code</label>
                                    <input type="text" id="zip" name="zip" required placeholder="19707" inputmode="numeric" autocomplete="postal-code" pattern="[0-9]{5}">
                                </div>
                                <div></div>
                            </div>
                        </div>

                        <button type="submit" class="deposit-submit-btn">
                            <svg viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                            Pay $1,000 Design Deposit
                        </button>

                        <a href="/contact/" class="consultation-link">Or schedule a free consultation first</a>

                        <div class="legal-text">
                            By submitting this form, you agree to our <a href="/terms-of-service/" style="color:var(--aqua);">Terms of Service</a> and <a href="/privacy-policy/" style="color:var(--aqua);">Privacy Policy</a>. Your $1,000 design deposit is fully refundable within 72 hours of payment. This deposit reserves your installation spot and is applied toward your total project cost. Pennsylvania Home Improvement Consumer Protection Act disclosures apply. Tri-State Aquatic Solutions, LLC is a licensed and insured pool contractor.
                        </div>
                    </form>
                </div>

                <div class="step-nav">
                    <button class="back-btn" onclick="goToStep(4)">
                        <svg viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                        Back
                    </button>
                    <div></div>
                </div>
            </div>

        </div>
    </div>

    <!-- Mobile Sticky Continue -->
    <div class="mobile-sticky-nav" id="mobileStickyNav">
        <button class="continue-btn" id="mobileContinueBtn" onclick="mobileNext()">
            Continue
            <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <a href="/" class="logo">
                        <div class="logo-mark"></div>
                        <div class="logo-text">
                            Tri-State Aquatic
                            <span>Solutions</span>
                        </div>
                    </a>
                    <p>Premium pool installation and expert maintenance services for Main Line Philadelphia and Northern Delaware. Your local pool professionals.</p>
                </div>
                <div class="footer-column install-column">
                    <h4>Pool Installation</h4>
                    <ul>
                        <li><a href="/pools/plunge-pools/">Plunge Pools</a></li>
                        <li><a href="/pools/cocktail-pools/">Cocktail Pools</a></li>
                        <li><a href="/pools/fiberglass/">Fiberglass Pools</a></li>
                        <li><a href="/gallery/">Pool Gallery</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Pool Services</h4>
                    <ul>
                        <li><a href="/services/weekly-maintenance/">Weekly Maintenance</a></li>
                        <li><a href="/services/pool-opening/">Pool Opening</a></li>
                        <li><a href="/services/pool-closing/">Pool Closing</a></li>
                        <li><a href="/services/equipment-repair/">Equipment Repair</a></li>
                        <li><a href="/services/emergency/">Emergency Service</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Service Areas</h4>
                    <ul>
                        <li><a href="/locations/hockessin-de/">Hockessin, DE</a></li>
                        <li><a href="/locations/greenville-de/">Greenville, DE</a></li>
                        <li><a href="/locations/west-chester-pa/">West Chester, PA</a></li>
                        <li><a href="/locations/bryn-mawr-pa/">Bryn Mawr, PA</a></li>
                        <li><a href="/locations/">All Locations</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Tri-State Aquatic Solutions. All rights reserved.</p>
                <div class="footer-legal">
                    <a href="/privacy-policy/">Privacy Policy</a>
                    <a href="/terms-of-service/">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
    // ==================== STATE ====================
    var config = {
        pool: null,
        finish: null,
        color: 'light',
        upgrades: [],
        currentStep: 1
    };

    // Restore from sessionStorage
    (function() {
        try {
            var saved = sessionStorage.getItem('poolConfig');
            if (saved) {
                var parsed = JSON.parse(saved);
                if (parsed && parsed.pool) config = parsed;
            }
        } catch(e) {}

        // Check URL params for deep linking
        var params = new URLSearchParams(window.location.search);
        var start = params.get('start');
        if (start) {
            var poolMap = { devon: 'devon', gladwyne: 'gladwyne', brandywine: 'brandywine',
                           retreat: 'devon', centerpiece: 'gladwyne', experience: 'brandywine' };
            if (poolMap[start]) {
                config.pool = poolMap[start];
                config.currentStep = 1;
            }
        }
    })();

    // ==================== PRICE DATA ====================
    var priceData = {
        devon:      { low: 45000, high: 55000 },
        gladwyne:   { low: 55000, high: 68000 },
        brandywine: { low: 68000, high: 85000 }
    };

    var finishAdj = {
        concrete:   { low: 0,     high: 0 },
        plaster:    { low: 3000,  high: 5000 },
        fiberglass: { low: -8000, high: -5000 }
    };

    var upgradeAdj = {
        heater:         { low: 4000,  high: 6000 },
        'tanning-ledge':{ low: 3000,  high: 5000 },
        bench:          { low: 1500,  high: 2500 },
        jets:           { low: 4000,  high: 7000 },
        cover:          { low: 8000,  high: 12000 },
        smart:          { low: 3000,  high: 5000 }
    };

    // ==================== POOL NAMES ====================
    var poolNames = {
        devon: 'The Devon',
        gladwyne: 'The Gladwyne',
        brandywine: 'The Brandywine'
    };

    var finishNames = {
        concrete: 'Precast Concrete',
        plaster: 'Plaster & Tile',
        fiberglass: 'Fiberglass Composite'
    };

    var upgradeNames = {
        heater: 'Pool Heater',
        'tanning-ledge': 'Tanning Ledge',
        bench: 'Built-In Bench',
        jets: 'Hydrotherapy Jets',
        cover: 'Automatic Cover',
        smart: 'Smart Controls'
    };

    // ==================== POOL SPECS DATA ====================
    var poolSpecsData = {
        devon: {
            dims: '7\' Ã— 13\'',
            depth: '52" (4\'4")',
            volume: '~2,800 gallons',
            shell: '6" steel-reinforced concrete',
            install: '1-2 weeks on-site',
            features: ['4 return jets', 'Surface skimmer', 'LED lighting', 'Cartridge filter system', 'Variable speed pump', 'Stainless steel handrail', 'Basic maintenance equipment'],
            note: 'Smallest footprint â€” doubles as a hot tub with heater upgrade'
        },
        gladwyne: {
            dims: '9\' Ã— 16\'',
            depth: '3\'5" - 5\'4"',
            volume: '~5,200 gallons',
            shell: '6" steel-reinforced concrete',
            install: '2-3 weeks on-site',
            features: ['4 return jets', 'Surface skimmer', 'LED lighting', 'Cartridge filter system', 'Variable speed pump', 'Stainless steel handrail', 'Maintenance equipment included'],
            note: 'Most popular size â€” room for play and entertaining without excess maintenance'
        },
        brandywine: {
            dims: '9\' Ã— 21\'',
            depth: '3\'5" - 5\'4"',
            volume: '~8,500 gallons',
            shell: '6" steel-reinforced concrete',
            install: '3-4 weeks on-site',
            features: ['4 return jets', 'Surface skimmer', 'LED lighting', 'Cartridge filter system', 'Variable speed pump', 'Stainless steel handrail', 'Maintenance equipment included'],
            note: 'Largest precast plunge pool available â€” optional integrated spa section heats in under 30 minutes'
        }
    };

    // Hero images for summary step, mapped to pool selection
    var summaryHeroImages = {
        devon: '/images/wellness-plunge.jpg',
        gladwyne: '/images/pools/family-lifestyle.jpg',
        brandywine: '/images/pools/pool-spa-combo.jpg'
    };

    // ==================== POOL HERO + DIMENSION DIAGRAMS ====================
    var poolHeroData = {
        devon:      { img: '/images/wellness-plunge.jpg', dims: '7\' Ã— 13\'', w: 70, h: 130 },
        gladwyne:   { img: '/images/pools/family-lifestyle.jpg', dims: '9\' Ã— 16\'', w: 90, h: 160 },
        brandywine: { img: '/images/pools/pool-spa-combo.jpg', dims: '9\' Ã— 21\'', w: 90, h: 210 }
    };

    function updateSelectedPoolHero(poolType) {
        var hero = document.getElementById('selectedPoolHero');
        if (!hero) return;

        var data = poolHeroData[poolType];
        if (!data) { hero.classList.remove('visible'); return; }

        document.getElementById('selectedPoolHeroImg').src = data.img;
        document.getElementById('selectedPoolHeroName').textContent = poolNames[poolType];
        var depthText = poolType === 'devon' ? '52" depth' : '3\'5" - 5\'4" depth';
        var capacityText = poolType === 'devon' ? '2-4' : poolType === 'gladwyne' ? '4-6' : '6-10';
        document.getElementById('selectedPoolHeroDims').textContent = data.dims + '  â€¢  ' + depthText + '  â€¢  ' + capacityText + ' people';

        // Build SVG dimension diagram
        var scale = 0.6;
        var w = Math.round(data.w * scale);
        var h = Math.round(data.h * scale);
        var pad = 32;
        var svgW = w + pad * 2;
        var svgH = h + pad * 2;

        var svg = '<svg width="' + svgW + '" height="' + svgH + '" viewBox="0 0 ' + svgW + ' ' + svgH + '">';
        // Pool shape
        svg += '<rect x="' + pad + '" y="' + pad + '" width="' + w + '" height="' + h + '" rx="8" fill="rgba(0,166,178,0.2)" stroke="#C9A962" stroke-width="1.5"/>';
        // Width dimension line (top)
        svg += '<line x1="' + pad + '" y1="' + (pad - 12) + '" x2="' + (pad + w) + '" y2="' + (pad - 12) + '" stroke="#C9A962" stroke-width="1"/>';
        svg += '<line x1="' + pad + '" y1="' + (pad - 16) + '" x2="' + pad + '" y2="' + (pad - 8) + '" stroke="#C9A962" stroke-width="1"/>';
        svg += '<line x1="' + (pad + w) + '" y1="' + (pad - 16) + '" x2="' + (pad + w) + '" y2="' + (pad - 8) + '" stroke="#C9A962" stroke-width="1"/>';
        svg += '<text x="' + (pad + w/2) + '" y="' + (pad - 18) + '" text-anchor="middle" fill="#C9A962" font-size="11" font-family="Outfit">' + (poolType === 'devon' ? "7'" : "9'") + '</text>';
        // Height dimension line (right)
        svg += '<line x1="' + (pad + w + 12) + '" y1="' + pad + '" x2="' + (pad + w + 12) + '" y2="' + (pad + h) + '" stroke="#C9A962" stroke-width="1"/>';
        svg += '<line x1="' + (pad + w + 8) + '" y1="' + pad + '" x2="' + (pad + w + 16) + '" y2="' + pad + '" stroke="#C9A962" stroke-width="1"/>';
        svg += '<line x1="' + (pad + w + 8) + '" y1="' + (pad + h) + '" x2="' + (pad + w + 16) + '" y2="' + (pad + h) + '" stroke="#C9A962" stroke-width="1"/>';
        svg += '<text x="' + (pad + w + 20) + '" y="' + (pad + h/2 + 4) + '" fill="#C9A962" font-size="11" font-family="Outfit">' + (poolType === 'devon' ? "13'" : poolType === 'gladwyne' ? "16'" : "21'") + '</text>';
        svg += '</svg>';

        document.getElementById('poolDiagramSvg').innerHTML = svg;
        hero.classList.add('visible');
    }

    function updateModelGallery(poolType) {
        var gallery = document.getElementById('modelGallery');
        var strip = document.getElementById('modelStrip');
        var subtitle = document.getElementById('modelGallerySubtitle');
        if (!gallery || !strip) return;

        var specs = poolSpecsData[poolType];
        if (!specs) {
            gallery.classList.remove('visible');
            return;
        }

        subtitle.textContent = 'Standard features included with every ' + poolNames[poolType];

        var html = '<div class="pool-specs-panel">';
        html += '<div class="specs-quick-stats">';
        html += '<div class="specs-stat"><span class="specs-stat-value">' + specs.dims + '</span><span class="specs-stat-label">Dimensions</span></div>';
        html += '<div class="specs-stat"><span class="specs-stat-value">' + specs.depth + '</span><span class="specs-stat-label">Depth</span></div>';
        html += '<div class="specs-stat"><span class="specs-stat-value">' + specs.volume + '</span><span class="specs-stat-label">Water Volume</span></div>';
        html += '<div class="specs-stat"><span class="specs-stat-value">' + specs.install + '</span><span class="specs-stat-label">Installation</span></div>';
        html += '</div>';
        html += '<div class="specs-features-list">';
        specs.features.forEach(function(f) {
            html += '<div class="specs-feature"><svg viewBox="0 0 24 24" width="16" height="16"><polyline points="20 6 9 17 4 12" fill="none" stroke="#C9A962" stroke-width="2.5"/></svg>' + f + '</div>';
        });
        html += '</div>';
        if (specs.note) {
            html += '<div class="specs-note">' + specs.note + '</div>';
        }
        html += '</div>';

        strip.innerHTML = html;
        gallery.classList.add('visible');
    }

    // ==================== SELECTIONS ====================
    function selectPool(el) {
        document.querySelectorAll('.lifestyle-card').forEach(function(c) { c.classList.remove('selected'); });
        el.classList.add('selected');
        config.pool = el.getAttribute('data-pool');
        saveState();
        updateContinueButtons();
        trackEvent('pool_selected', { pool_type: config.pool });

        // Show/hide spa upgrade for experience
        var spaEl = document.getElementById('spaUpgrade');
        if (spaEl) spaEl.style.display = config.pool === 'brandywine' ? 'grid' : 'none';

        // Show pool hero + specs for selected pool type
        updateSelectedPoolHero(config.pool);
        updateModelGallery(config.pool);

        // Scroll so the hero/specs are visible
        setTimeout(function() {
            var hero = document.getElementById('selectedPoolHero');
            if (hero && hero.classList.contains('visible')) {
                hero.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }, 100);
    }

    function selectFinish(el) {
        document.querySelectorAll('.finish-card').forEach(function(c) { c.classList.remove('selected'); });
        el.classList.add('selected');
        config.finish = el.getAttribute('data-finish');
        saveState();
        updateContinueButtons();
        trackEvent('finish_selected', { finish_type: config.finish });

        // Show color swatches for fiberglass
        var swatches = document.getElementById('colorSwatches');
        if (config.finish === 'fiberglass') {
            swatches.classList.add('visible');
        } else {
            swatches.classList.remove('visible');
        }
    }

    function selectColor(el) {
        document.querySelectorAll('.swatch').forEach(function(s) { s.classList.remove('selected'); });
        el.classList.add('selected');
        config.color = el.getAttribute('data-color');
        saveState();
    }

    function toggleUpgrade(el) {
        if (el.classList.contains('pre-included')) return;
        var upgrade = el.getAttribute('data-upgrade');
        var idx = config.upgrades.indexOf(upgrade);
        if (idx > -1) {
            config.upgrades.splice(idx, 1);
            el.classList.remove('selected');
            trackEvent('upgrade_toggled', { upgrade: upgrade, state: 'off' });
        } else {
            config.upgrades.push(upgrade);
            el.classList.add('selected');
            trackEvent('upgrade_toggled', { upgrade: upgrade, state: 'on' });
        }
        saveState();
    }

    function skipUpgrades() {
        config.upgrades = [];
        document.querySelectorAll('.upgrade-card').forEach(function(c) {
            if (!c.classList.contains('pre-included')) c.classList.remove('selected');
        });
        saveState();
        goToStep(4);
    }

    // ==================== PRICE CALCULATION ====================
    function calculatePrice() {
        if (!config.pool || !config.finish) return { low: 0, high: 0 };

        var base = priceData[config.pool];
        var finish = finishAdj[config.finish];
        var low = base.low + finish.low;
        var high = base.high + finish.high;

        config.upgrades.forEach(function(u) {
            if (upgradeAdj[u]) {
                low += upgradeAdj[u].low;
                high += upgradeAdj[u].high;
            }
        });

        // Ensure low doesn't exceed high
        if (low > high) { var tmp = low; low = high; high = tmp; }

        return { low: Math.max(0, low), high: Math.max(0, high) };
    }

    function formatPrice(n) {
        return '$' + n.toLocaleString();
    }

    function calculateMonthly(total) {
        // 180 months, 7.99% APR
        var rate = 0.0799 / 12;
        var n = 180;
        var payment = total * (rate * Math.pow(1 + rate, n)) / (Math.pow(1 + rate, n) - 1);
        return Math.round(payment);
    }

    // ==================== STEP NAVIGATION ====================
    function goToStep(step) {
        // Validation
        if (step === 2 && !config.pool) return;
        if (step === 3 && !config.finish) return;

        var currentStepEl = document.querySelector('.step.active');
        var targetStepEl = document.getElementById('step' + step);
        if (!targetStepEl) return;

        var goingForward = step > config.currentStep;

        // Track analytics
        trackEvent('configurator_step_' + step);

        // Exit current step
        if (currentStepEl) {
            currentStepEl.classList.remove('visible');
            currentStepEl.classList.add(goingForward ? 'exit-left' : '');
            setTimeout(function() {
                currentStepEl.classList.remove('active', 'exit-left');
            }, 300);
        }

        // Update state
        config.currentStep = step;
        saveState();

        // Enter new step
        setTimeout(function() {
            targetStepEl.classList.add('active');
            targetStepEl.style.transform = goingForward ? 'translateX(60px)' : 'translateX(-60px)';
            targetStepEl.style.opacity = '0';

            // Force reflow
            targetStepEl.offsetHeight;

            requestAnimationFrame(function() {
                targetStepEl.classList.add('visible');
                targetStepEl.style.transform = '';
                targetStepEl.style.opacity = '';
            });

            // Update UI
            updateProgressBar(step);
            updateStepIndicator(step);
            updateContinueButtons();
            updateMobileStickyNav(step);

            // Update summary if going to step 4
            if (step === 4) updateSummary();
            if (step === 5) updateDepositForm();

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }, 350);
    }

    function updateProgressBar(step) {
        document.querySelectorAll('.progress-segment').forEach(function(seg) {
            var s = parseInt(seg.getAttribute('data-step'));
            seg.classList.remove('active', 'completed');
            if (s < step) seg.classList.add('completed');
            if (s === step) seg.classList.add('active');
        });
    }

    function updateStepIndicator(step) {
        var text = document.getElementById('stepText');
        if (text) text.textContent = 'Step ' + step + ' of 5';
    }

    function updateContinueButtons() {
        var step1Btn = document.getElementById('continueStep1');
        var step2Btn = document.getElementById('continueStep2');
        var mobileBtn = document.getElementById('mobileContinueBtn');

        if (step1Btn) {
            if (config.pool) step1Btn.classList.add('enabled');
            else step1Btn.classList.remove('enabled');
        }

        if (step2Btn) {
            if (config.finish) step2Btn.classList.add('enabled');
            else step2Btn.classList.remove('enabled');
        }

        // Mobile button mirrors current step
        if (mobileBtn) {
            var step = config.currentStep;
            if (step === 1 && config.pool) mobileBtn.classList.add('enabled');
            else if (step === 2 && config.finish) mobileBtn.classList.add('enabled');
            else if (step === 3) mobileBtn.classList.add('enabled');
            else mobileBtn.classList.remove('enabled');
        }
    }

    function updateMobileStickyNav(step) {
        var nav = document.getElementById('mobileStickyNav');
        // Hide on summary and deposit steps
        if (step >= 4) {
            nav.style.display = 'none';
        } else {
            nav.style.display = '';
        }
    }

    function mobileNext() {
        var step = config.currentStep;
        if (step < 5) goToStep(step + 1);
    }

    // ==================== SUMMARY ====================
    function animateCounter(el, target, duration) {
        var start = 0;
        var startTime = null;
        function step(timestamp) {
            if (!startTime) startTime = timestamp;
            var progress = Math.min((timestamp - startTime) / duration, 1);
            var eased = 1 - Math.pow(1 - progress, 3);
            el.textContent = Math.floor(eased * target) + '+';
            if (progress < 1) requestAnimationFrame(step);
        }
        requestAnimationFrame(step);
    }

    function updateSummary() {
        var price = calculatePrice();

        document.getElementById('summaryPool').textContent = poolNames[config.pool] || '--';
        document.getElementById('summaryFinish').textContent = finishNames[config.finish] || '--';

        // Animate pool counter
        var counter = document.getElementById('poolCounter');
        if (counter) animateCounter(counter, 47, 1500);

        // Track social proof view
        trackEvent('social_proof_viewed');

        // Update summary hero image
        var heroImg = document.getElementById('summaryHeroImg');
        var heroLabel = document.getElementById('summaryHeroLabel');
        if (heroImg && summaryHeroImages[config.pool]) {
            heroImg.src = summaryHeroImages[config.pool];
        }
        if (heroLabel) {
            heroLabel.textContent = poolNames[config.pool] || 'Your Pool';
        }

        // Color row
        var colorRow = document.getElementById('summaryColorRow');
        if (config.finish === 'fiberglass') {
            colorRow.style.display = '';
            document.getElementById('summaryColor').textContent = config.color.charAt(0).toUpperCase() + config.color.slice(1);
        } else {
            colorRow.style.display = 'none';
        }

        // Upgrades
        if (config.upgrades.length > 0) {
            var names = config.upgrades.map(function(u) { return upgradeNames[u] || u; });
            document.getElementById('summaryUpgrades').textContent = names.join(', ');
        } else {
            document.getElementById('summaryUpgrades').textContent = 'None';
        }

        // Pricing
        document.getElementById('summaryPrice').textContent = formatPrice(price.low) + ' - ' + formatPrice(price.high);

        // Monthly
        var avgPrice = Math.round((price.low + price.high) / 2);
        var monthly = calculateMonthly(avgPrice);
        document.getElementById('summaryMonthly').textContent = '$' + monthly.toLocaleString() + '/mo';
    }

    function updateDepositForm() {
        var price = calculatePrice();
        document.getElementById('configPool').textContent = poolNames[config.pool] || '--';
        document.getElementById('configFinish').textContent = finishNames[config.finish] || '--';

        if (config.upgrades.length > 0) {
            var names = config.upgrades.map(function(u) { return upgradeNames[u] || u; });
            document.getElementById('configUpgrades').textContent = names.join(', ');
        } else {
            document.getElementById('configUpgrades').textContent = 'None';
        }

        document.getElementById('configPrice').textContent = formatPrice(price.low) + ' - ' + formatPrice(price.high);
    }

    // ==================== DEPOSIT FORM ====================
    function handleDeposit(e) {
        e.preventDefault();

        var price = calculatePrice();

        var customerData = {
            firstName: document.getElementById('firstName').value,
            lastName: document.getElementById('lastName').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            address: document.getElementById('address').value,
            city: document.getElementById('city').value,
            state: document.getElementById('state').value,
            zip: document.getElementById('zip').value
        };

        var payload = {
            customer: customerData,
            configuration: {
                pool: config.pool,
                poolName: poolNames[config.pool],
                finish: config.finish,
                finishName: finishNames[config.finish],
                color: config.finish === 'fiberglass' ? config.color : null,
                upgrades: config.upgrades,
                upgradeNames: config.upgrades.map(function(u) { return upgradeNames[u]; }),
                priceRange: { low: price.low, high: price.high }
            },
            amount: 100000 // $1,000 in cents
        };

        // Save state before redirect
        sessionStorage.setItem('poolConfig', JSON.stringify(config));
        sessionStorage.setItem('depositPayload', JSON.stringify(payload));

        trackEvent('begin_checkout', {
            pool_type: config.pool,
            finish_type: config.finish,
            upgrades: config.upgrades.join(','),
            price_low: price.low,
            price_high: price.high
        });

        // POST to Stripe checkout
        fetch('/api/stripe/create-checkout-session', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.url) {
                window.location.href = data.url;
            } else {
                alert('Something went wrong. Please call us at (302) 870-3113 to complete your deposit.');
            }
        })
        .catch(function() {
            alert('Something went wrong. Please call us at (302) 870-3113 to complete your deposit.');
        });
    }

    // ==================== CONFIG COLLAPSE ====================
    function toggleConfigSummary() {
        document.getElementById('configCollapse').classList.toggle('open');
    }

    // ==================== PERSISTENCE ====================
    function saveState() {
        try {
            sessionStorage.setItem('poolConfig', JSON.stringify(config));
        } catch(e) {}
    }

    // ==================== ANALYTICS ====================
    function trackEvent(name, props) {
        props = props || {};

        // GA4
        if (typeof gtag !== 'undefined') {
            gtag('event', name, props);
        }

        // PostHog
        if (typeof posthog !== 'undefined') {
            posthog.capture(name, props);
        }
    }

    // ==================== MOBILE BACK ====================
    document.getElementById('mobileBack').addEventListener('click', function() {
        if (config.currentStep > 1) {
            goToStep(config.currentStep - 1);
        } else {
            window.location.href = '/';
        }
    });

    // ==================== INIT ====================
    (function init() {
        // Restore selections from state
        if (config.pool) {
            var poolCard = document.querySelector('.lifestyle-card[data-pool="' + config.pool + '"]');
            if (poolCard) poolCard.classList.add('selected');

            // Spa upgrade visibility
            var spaEl = document.getElementById('spaUpgrade');
            if (spaEl) spaEl.style.display = config.pool === 'brandywine' ? 'grid' : 'none';

            // Restore pool hero + model gallery
            updateSelectedPoolHero(config.pool);
            updateModelGallery(config.pool);
        }

        if (config.finish) {
            var finishCard = document.querySelector('.finish-card[data-finish="' + config.finish + '"]');
            if (finishCard) finishCard.classList.add('selected');

            if (config.finish === 'fiberglass') {
                document.getElementById('colorSwatches').classList.add('visible');
            }
        }

        if (config.color) {
            document.querySelectorAll('.swatch').forEach(function(s) { s.classList.remove('selected'); });
            var colorSwatch = document.querySelector('.swatch[data-color="' + config.color + '"]');
            if (colorSwatch) colorSwatch.classList.add('selected');
        }

        if (config.upgrades && config.upgrades.length > 0) {
            config.upgrades.forEach(function(u) {
                var card = document.querySelector('.upgrade-card[data-upgrade="' + u + '"]');
                if (card) card.classList.add('selected');
            });
        }

        // Show current step
        var step = config.currentStep || 1;
        document.querySelectorAll('.step').forEach(function(s) { s.classList.remove('active', 'visible'); });
        var currentStepEl = document.getElementById('step' + step);
        if (currentStepEl) {
            currentStepEl.classList.add('active');
            // Small delay to trigger animation
            requestAnimationFrame(function() {
                currentStepEl.classList.add('visible');
            });
        }

        updateProgressBar(step);
        updateStepIndicator(step);
        updateContinueButtons();
        updateMobileStickyNav(step);

        if (step === 4) updateSummary();
        if (step === 5) updateDepositForm();

        // Track initial step view
        trackEvent('configurator_step_' + step);
    })();

    // Mobile menu toggle
    function toggleMobileMenu() {
        var menu = document.getElementById('mobileMenu');
        menu.classList.toggle('open');
    }

    document.querySelectorAll('.mobile-menu a').forEach(function(link) {
        link.addEventListener('click', function() {
            document.getElementById('mobileMenu').classList.remove('open');
        });
    });
    </script>
</body>
</html>
